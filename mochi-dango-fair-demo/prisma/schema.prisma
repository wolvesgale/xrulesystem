// Prisma schema for Neon-backed multi-tenant scheduling data.
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  super_admin
  admin
  agent
}

model Tenant {
  id           String   @id @default(cuid())
  name         String
  primaryColor String?
  accentColor  String?
  logoUrl      String?
  siteTitle    String?
  plan         String?
  status       String   @default("active")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  agencies     Agency[]
  users        User[]
  venues       Venue[]
  events       Event[]
}

model User {
  id           String    @id @default(cuid())
  loginId      String    @unique
  email        String?   @unique
  name         String
  displayName  String?
  role         UserRole
  passwordHash String
  tenantId     String?
  agencyId     String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  tenant       Tenant?   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  agency       Agency?   @relation(fields: [agencyId], references: [id], onDelete: Cascade)
}

model Agency {
  id        String   @id @default(cuid())
  tenantId  String
  name      String
  color     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users     User[]
  events    Event[]
}

model Venue {
  id           String      @id @default(cuid())
  tenantId     String
  name         String
  address      String?
  rules        String?
  notes        String?
  referenceUrl String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  tenant       Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  events       Event[]
  venueNotes   VenueNote[]
}

model Event {
  id             String     @id @default(cuid())
  tenantId       String
  agencyId       String
  venueId        String?
  title          String
  startDate      DateTime
  endDate        DateTime
  commissionRate Float?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  tenant         Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  agency         Agency     @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  venue          Venue?     @relation(fields: [venueId], references: [id], onDelete: SetNull)
  eventDays      EventDay[]
}

model EventDay {
  id        String   @id @default(cuid())
  eventId   String
  date      DateTime
  startTime String
  endTime   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model VenueNote {
  id        String   @id @default(cuid())
  venueId   String
  title     String
  fileUrl   String?
  memo      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  venue     Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)
}
